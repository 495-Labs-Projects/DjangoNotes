# Django Application Development Cheatsheet

## Start a Django Project

There are three main ways to execute admin related tasks using django. These tasks include created starter code for a Django project/app, migrating your database, and even running your server. These three ways are all rather similar but all have its purposes, you will learn specific differences later on.

```
$ django-admin <command> [options]
$ manage.py <command> [options]
$ python -m django <command> [options]
```

Generally before, we start a Django project/app we will use django-admin to run commands to create a new Django project/app. Later on, once we have created our app, we tend to use manage.py as a way to run our commands like runserver. Read [here](https://docs.djangoproject.com/en/1.11/ref/django-admin/) for more information regarding the different commands available.

#### Create a Django Project

Before writing any python code we need to generate the starter template/code for our Django project. Run the following command to create a folder with your Django project, where `mysite` is the name of the project:

```
$ django-admin startproject mysite
```

The `startproject` command creates a Django project directory structure for the given project name in the current directory. startproject created a directory called mysite with a bunch of different files in it like the following:

```
mysite/
    manage.py
    mysite/
        __init__.py
        settings.py
        urls.py
        wsgi.py
```

Don't worry too much about understanding all of these file yet, we will go into more details later on, but the following is a quick description of each file/directory:
* The outer mysite/ root directory is just a container for your project. Its name doesnâ€™t matter to Django; you can rename it to anything you like.
* manage.py: A command-line utility that lets you interact with this Django project in various ways.
* The inner mysite/ directory is the actual Python package for your project. Its name is the Python package name you'll need to use to import anything inside it (e.g. mysite.urls).
* mysite/__init__.py: An empty file that tells Python that this directory should be considered a Python package.
* mysite/settings.py: Settings/configuration for this Django project. Django settings will tell you all about how settings work.
* mysite/urls.py: The URL declarations for this Django project; a "table of contents" of your Django-powered site.
* mysite/wsgi.py: An entry-point for WSGI-compatible web servers to serve your project.

#### Create a Django App

Now we will be creating a Django app within your Django project. Each project generally has one or many apps within it. Apps are what you generally think of as a major feature of a project. Here is a quick description of the difference between project and app:
* Project
  * A project is a collection of applications, installed into the same database, and all using the same settings file. In a sense, the defining aspect of a project is that it supplies a settings file which specifies the database to use, the applications to install, and other bits of configuration. 
  * ex) Sports Website
* App
  * An application tries to provide a single, relatively self-contained set of related functions. An application is allowed to define a set of models and to define and register custom template tags and filters.
  * ex) user login app, user notifications app, newletter app, etc.

Now lets create a Django app called `helloworld` within our `mysite` project:

```
$ manage.py startapp helloworld
```

Here is what is generated by the `startapp` command:

```
helloworld/
    __init__.py
    admin.py
    apps.py
    migrations/
        __init__.py
    models.py
    tests.py
    views.py
```

#### Starting up the server

Now we will be able to run our server with in our Django Project. This is as simple as running the following command:

```
$ manage.py runserver
```

or in order to specify a port/IP address (0.0.0.0:8080):

```
$ manage.py runserver 0:8080
```


## Create models and database

Since we are using SQLite, we won't really need to do too much setup in order to get the database running. 

#### Migrating the database

Under `mysite/settings.py` there are `INSTALLED_APPS` by default (you can also add your own apps here too). There installed apps all have its own models and needs access to certain database tables. In order to set up those database tables, we need to migrate our database by running the following command (Note: the migrate command only runs migrations for apps included in the `INSTALLED_APPS`):

```
$ manage.py migrate
```

#### Creating models

Now we will create a simple model and run through the migration progress for our `helloworld` app. Let's create a User model with two fields (first_name, last_name). We will not go into details of how to create more complicated models, but in this case we created a User model with two character string fields of max length 200 each. We should always include a str representation of each model because it is what will be displayed everywhere to represent each instance of the model; in this case we will just be using the full user's name.

In our `helloworld/models.py` files put the following:

```
from django.db import models

class User(models.Model):
  first_name = models.ChartField(max_length=200)
  last_name = models.CharField(max_length=200)

  def __str__(self):
        return self.first_name + " " + self.last_name

```

#### Migrate models and activate app

First we need to include our `helloworld` app into our `INSTALLED_APPS` hash. Go to your `mysite/settings.py` file and add the following `'helloworld.apps.HelloworldConfig',` to the `INSTALLED_APPS`:

```
INSTALLED_APPS = [
    'helloworld.apps.HelloworldConfig',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]
```

Now that Django knows to include the hellowolrd app, we can create a migration file for the newly created models:

```
$ manage.py makemigrations helloworld
```

This will create a migration file under `helloworld/migrations/0001_intial.py`. You will need to run the makemigration command everytime you make some changes to the models.

Now you will need to run the actual migration file that you created for the helloworld application:

```
$ manage.py migrate
```

`makemigrations` is used to create migrations for the changes to the models that you made. 

`migrate` actually applies those changes to the database.


## Accessing Django Shell

Django also provides an interactive shell for you to work with and interact with the project and its database. Here we will go through how to interact with the database through our models.

#### Accessing the shell

In order to access the shell, enter the following command:

```
$ manage.py shell
```

Once you are in the shell import the actual models that you have created, in this case the User model:

```
>>> from helloworld.models import User
```

#### Interacting with the models

For the purpose of this tutorial lets say we have two more models Town and Attraction, where it is a one to many relationship between Town and Attraction. The following would be how the model would look like:

```
class Town(models.Model):
    name = models.CharField(max_length=200)

class Attraction(models.Model):
    town = models.ForeignKey(Town, on_delete=models.CASCADE)
    name = models.CharField(max_length=200)
    visitors = models.IntegerField(default=0)

```

From within the shell, here are a bunch of actions you can take with the models:
* Get all instances of the model
  ```
  # all of the return types are QuerySet, which you can iterate through like a list
  >>> Town.objects.all()
  >>> User.objects.all()
  >>>
  >>> Attraction.objects.count()
  ```
* Save an instance of each model
  ```
  >>> u = User(first_name="Bob", last_name="Smith")
  >>> u.save()
  >>> User.objects.all()
  # Notice how the users will be displayed using the str representation  

  ...

  # create does the save automatically
  >>> t = Town.objects.create(name="Pittsburgh")
  
  ...

  >>> t.attraction_set.all() # this gets all the attractions related to t
  >>> t.attraction_set.create(name="CMU", visitors=100)
  >>> t.attraction_set.create(name="Cathedral of Learning", visitors=999)

  ...
  
  # display all the changes that we have made
  >>> User.objects.all()
  >>> Town.objects.all()
  >>> Attraction.objects.all()
  >>> t.attraction_set.all()
  ```
* Get object relationships
  ```
  >>> t = Town.objects.all()[0] # get the first town instance
  >>> a = Attraction.objects.all()[0]
  >>>
  >>> t.attraction_set.all() # get all attractions related to the town t
  >>>
  >>> a.town # gets the town that is related to the attraction a
  ```
* Get certain objects
  * Get only one object (returns one instance of the model)
    ```
    # these two mean the same
    >>> Question.objects.get(id=2)
    >>> Question.objects.get(fk=2)
    ```
  * Filter multiple object (returns a QuerySet of multiple instances)
    ```
    # gets all the users where the first_name == "Bob"
    >>> User.objects.filter(first_name="Bob")
    >>>
    >>> t = Town.objects.get(id=1)
    # the double underscore __ is used to denote an instance method
    # filters out all attractions related to Town t where name.startswidth == 'C'
    >>> t.attraction_set.filter(name__startswith='C')
    >>>
    # the double underscore is also used to go another level deep in relationships
    # gets all attractions where its town.name.startswidth == 'Pitt'
    >>> Attraction.objects.filter(town__name__startswith='Pitt')
    ```
* Modify an object
  ```
  >>> u = User.objects.all()[0]
  >>> u.first_name = "John"
  >>> u.save()
  ```
* Delete an object
  ```
  >>> t = Town.objects.get(pk=1)
  >>> t.delete()
  ```